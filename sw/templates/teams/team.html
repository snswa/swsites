{% extends "teams/base.html" %}

{% load breadcrumbs %}
{% load events %}
{% load feature_tag %}
{% load group_tags %}
{% load sw_tags %}
{% load team_tags %}

{% block head_title %}{{ group.name }}{% endblock %}

{% block body_class %}{{ block.super }} team-{{ group.slug }}{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    {% for parent in group.parents %}
        {% breadcrumb_url_css "icon-link group-link" parent.name teams_team_index slug=parent.slug %}
    {% endfor %}
    {% breadcrumb_css "icon-link group-link" group.name "./" %}
{% endblock %}


{% block body %}
    {% if group.is_private and not user|ismemberofgroup:group %}
        <p>This team is private.</p>
    {% else %}
        <h1>About the <strong>{{ group.name }}</strong> team</h1>

        {% if team_wiki_index_page %}
            {% with team_wiki_index_page.current as rev %}
                {% include "wakawaka/page_content.html" %}
            {% endwith %}
        {% endif %}

        <div class="grid_4 alpha">
            <h1>Recent activity</h1>

            {% with group|teamactions:5 as recent_actions %}
                {% if recent_actions %}
                    <ul class="stream">
                        {% for action in recent_actions %}
                            <li class="event">
                                {% include "activity/action.html" %}
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endwith %}

            <p><a href="{% url team_activity_history slug=group.slug %}"><strong>Activity history Â»</strong></a></p>
        </div>

        <div class="grid_4 omega">
            <h1>Upcoming events</h1>

            {% content_objects group "dregni.Event" as events %}
            {% with events|upcomingevents:28 as events %}
                {% if events %}
                    <ul>
                        {% for event in events %}
                            <li>{% include "dregni/event_summary.html" %}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No upcoming events in the next four weeks.</p>
                {% endif %}
            {% endwith %}

            <ul>
                <li><a href="{% groupurl dregni_index group %}">View this team's calendar</a>.</li>
                {% if group.is_private and user|ismemberofgroup:group or user|iscoordinatorofteam:group %}
                    <li><a href="{% groupurl dregni_event_create group %}">Create a new team event</a>.</li>
                {% endif %}
            </ul>

        </div>
    {% endif %}
{% endblock %}

{% block sidebar_sections %}
    {% if user|ismemberofgroup:group or not group.is_private  %}

        {% include "sidebars/teammembers.html" %}

        {% include "sidebars/teamjoinleave.html" %}

        {% include "sidebars/moreteams.html" %}

        {% include "sidebars/wikicommon.html" %}

    {% endif %}
{% endblock %}
