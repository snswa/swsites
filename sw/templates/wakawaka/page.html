{% extends "wakawaka/base.html" %}

{% load comments %}
{% load group_tags %}
{% load i18n %}
{% load wakawaka_tags %}
{% load wakacms_tags %}

{% block extrahead %}
	{{ block.super }}

	{# Don't let search engines scan this old revision #}
	{% if rev.is_not_current %}
		<meta name="robots" content="noindex" />
	{% endif %}

	{# Add support for the Universal Edit Button #}
	{% if perms.wakawaka.change_wikipage %}
	<link rel="edit" title="{% trans "Edit this page" %}" href="{% groupurl wakawaka_edit group slug=page.slug %}" />
	{% endif %}
{% endblock %}

{% block title %}
	{{ page.slug }}
{% endblock %}

{% block content %}
	<h1><a name="top" href="{% groupurl wakawaka_page group slug=page.slug %}">{{ page.slug }}</a></h1>

	{% if rev.is_not_current %}
	<p class="revert-warning">
		{% trans "You are viewing an older revision!" %}
		<a href="{% groupurl wakawaka_page group slug=page.slug %}">
		  {% trans "See the latest version" %}
		</a>
	</p>
	{% endif %}

	<div class="page">
        {% include "wakawaka/page_content.html" %}
	</div>

    <h2>Comments</h2>

    {% get_comment_count for rev.page as comment_count %}
    {% if comment_count %}
        {% render_comment_list for rev.page %}
    {% else %}
        <p>Be the first to comment on this page.</p>
    {% endif %}

    {% with rev.page.get_absolute_url as next %}
        {% render_comment_form for rev.page %}
    {% endwith %}

{% endblock %}

{% block sidebar_sections %}
    {% if user.is_staff and not group %}
        <div class="section">
            <h1>Move Page To Team</h1>

            <form action="{% url temp_move_wiki_page %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="page_slug" value="{{ page.slug }}">
                <select name="team_slug" size="1">
                    {% for team in temp_all_teams_list %}
                        <option value="{{ team.slug }}">{{ team.name }}</option>
                    {% endfor %}
                </select>
                <input type="submit" name="submit" value="Move Page">
            </form>
        </div>
    {% endif %}

    <div class="section">
        <h1>This Wiki Page</h1>

        <ul>
        	{% if perms.wakawaka.change_wikipage %}
        		<li><strong><a href="{% groupurl wakawaka_edit group slug=page.slug %}">Edit this page</a></strong></li>
        	{% endif %}
            <li>Revision: {{ rev.id }}</li>
            <li>Changed by: <a href="{{ page.current.creator.get_absolute_url }}">{{ page.current.creator }}</a></li>
            <li>At: {{ rev.modified|date:_("DATETIME_FORMAT") }}</li>
            <li><a href="{% groupurl wakawaka_revision_list group slug=page.slug %}">Change history</a></li>
        </ul>

    	{% spaceless %}
    	<div class="related">
    	    {% related_cms_pages %}
    	</div>
    	{% endspaceless %}
    </div>

    {% include "sidebars/wikicommon.html" %}
{% endblock %}
